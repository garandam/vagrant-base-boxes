{"name":"Vagrant-base-boxes","tagline":"","body":"Vagrant base Box for CentOS 6.5\r\n=========\r\nI created a base Box for Vagrant based on CentOS 6.5 Minimal Install.\r\n\r\n### Features\r\n\r\n  - root password is \"vagrant\"\r\n  - Default vagrant \"insecure\" key\r\n  - Added EPEL repository\r\n  - Added PUPPET repository\r\n  - Installed \"Development Tools\"\r\n  - Installed wget, man, bind-utils\r\n  - Installed puppet, facter\r\n  - Installed Virtualbox Guest Additions\r\n\r\n### PreConditions (Windows)\r\n\r\n  - Vagrant (1.6.3)\r\n  - [Vagrant SSH-\"insecure\"-Key](https://github.com/mitchellh/vagrant/tree/master/keys)\r\n  - VirtualBox (4.3.12)\r\n  - Putty or Git-Bash\r\n\r\nCreate VM in VirtualBox without GUI\r\n--------------\r\nTo begin, we have to configure a new VM in VirtualBox.\r\n\r\n    Name: vagrant-{distro}-{version}\r\n    Type: Linux\r\n    Version: {distro} (64bit)\r\n    Memory: 1024MB \r\n    CPU: 1\r\n    Virtual Disk\r\n        VMDK (Dynamic)\r\n        Size: ~50GB\r\n    Disable Audio\r\n    Disable USB\r\n    Set Network Adapter 1 to NAT with Port Forwarding\r\n        Name: SSH\r\n        Protocol: TCP\r\n        Host Port: 2222\r\n        Guest Port: 22\r\n\r\nCreate VM in VirtualBox with GUI\r\n--------------\r\nTo begin, we have to configure a new VM in VirtualBox.\r\n\r\n    Name: vagrant-{distro}-{version}\r\n    Type: Linux\r\n    Version: {distro} (64bit)\r\n    Memory: 2048MB++ \r\n    CPU: 1 or 2\r\n    32MB Video RAM with 3D Acceleration to support GUI Desktop\r\n    Virtual Disk\r\n        VMDK (Dynamic)\r\n        Size: ~50GB\r\n    Disable Audio\r\n    Disable USB\r\n    Set Network Adapter 1 to NAT with Port Forwarding\r\n        Name: SSH\r\n        Protocol: TCP\r\n        Host Port: 2222\r\n        Guest Port: 22\r\n\r\nInstallation\r\n--------------\r\n\r\nDownload [CentOS 6.5](http://mirror.centos.org/centos-6/6.5/isos/)\r\n\t\r\n    Host Name: vagrant-{distro}-{version-nr}\r\n    Root Password: vagrant\r\n\r\nVM Config\r\n--------------\r\n#### Network interface\r\n    vi /etc/sysconfig/network-scripts/ifcfg-eth0\r\n    ONBOOT= yes\r\n    [ESC] :wq\r\n    \r\n    $ service network restart\r\n    \r\n##### (optional) Connect via Putty or Git-Bash \r\n    # Putty\r\n    IP 127.0.0.1\r\n    Port 2222 \r\n\t\r\n\t# Git-Bash\r\n\tssh -p 2222 root@localhost\r\n\tor\r\n\tssh -p 2222 root@127.0.0.1\r\n    \r\n#### Create User\r\n    $ useradd -m -c \"vagrant\" vagrant\r\n    $ passwd vagrant\r\n\r\n#### Add vagrant User to Sudoers\r\n    $ visudo\r\n    # Add the following line to the end of the file.\r\n    vagrant \tALL=(ALL) \tNOPASSWD:ALL\r\n    [ESC] :wq\r\n\r\n#### Add TTY and SSH-Auth (see Error solving at the end)\r\n\t$ visudo\r\n\t\r\n\t# Search \"Default requiretty\" and ignore it with #\r\n\t# Default requiretty\r\n\r\n\t# Search \"Defaults env_keep\" and add this new line at the end\r\n\tDefaults env_keep+=\"SSH_AUTH_SOCK\"\r\n\t[ESC] :wq\r\n\r\n#### (optional) Disable Firewall (iptables) and IPv6\r\n\t$ service iptables stop\r\n\t$ chkconfig iptables off\r\n\r\n\t$ vi /etc/sysctl.conf\r\n \t# Add the following line to the end of the file.\r\n\t# disable ipv6\r\n\tnet.ipv6.conf.all.disable_ipv6 = 1\r\n\tnet.ipv6.conf.default.disable_ipv6 = 1\r\n\t[ESC] :wq\r\n \r\n\t$ echo 1 > /proc/sys/net/ipv6/conf/all/disable_ipv6\r\n\t$ echo 1 > /proc/sys/net/ipv6/conf/default/disable_ipv6\r\n    \r\n#### Repos hinzuf√ºgen\r\n    # EPEL\r\n    $ rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\r\n\r\n    # PUPPET\r\n    $ rpm -ivh http://yum.puppetlabs.com/el/6/products/x86_64/puppetlabs-release-6-7.noarch.rpm\r\n\r\n#### Update Packages\r\n    $ yum update -y\r\n    $ shutdown -r now\r\n    \r\n#### Packages installieren\r\n    $ yum groupinstall \"Development Tools\"\r\n    $ yum install kernel-devel kernel-headers wget man bind-utils.x86_64\r\n    $ yum install dkms\r\n    $ yum install puppet facter\r\n\r\n#### OpenSSH configuration\r\n    $ vi /etc/ssh/sshd_config\r\n    Port 22\r\n    PubKeyAuthentication yes\r\n    AuthorizedKeysFile ~/.ssh/authorized_keys\r\n    PermitEmptyPasswords no\r\n    UseDNS no\r\n\t\r\n    $ service sshd restart\r\n\r\n#### Mount VirtualBox Guest Additions\r\n    $ mkdir /media/VirtualBoxGuestAdditions\r\n    $ mount -r /dev/cdrom /media/VirtualBoxGuestAdditions\r\n\r\n#### Install VirtualBox Guest Additions\r\n    $ cd /media/VirtualBoxGuestAdditions\r\n    $ ./VBoxLinuxAdditions.run\r\n\r\n    $ shutdown -r now\r\n    \r\n#### Vagrant OpenSSH-Keys\r\n    $ su vagrant\r\n    $ cd\r\n    $ mkdir .ssh\r\n    $ cd .ssh/\r\n    $ wget https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub -O authorized_keys\r\n    $ chmod 0700 .ssh/\r\n    $ chmod 0600 .ssh/authorized_keys\r\n    $ chown -R vagrant .ssh/\r\n\r\n#### Cleanup\r\n\t$ rm -rf /tmp/*\r\n\t$ rm -f /var/log/wtmp\r\n\t$ rm -f /var/log/btmp\r\n\t$ yum clean all\r\n\t$ history -c\r\n\r\n\t$ shutdown -h now\r\n\r\n#### Create the Box\r\n    # cd to Dir to Export Base-Box\r\n    $ vagrant package --base vagrant-{distro}-{version}\r\n    \r\n    ### SAMPLE\r\n    # cd to Dir to Export Base-Box\r\n    $ vagrant package --base vagrant-centos-6.5\r\n    $ mv package.box centos65-x86_64-20140707.box\r\n\r\n#### Testing & Working with the Box\r\n    $ vagrant box add {boxname} package.box\r\n    $ vagrant init {boxname}\r\n    $ vagrant up\r\n\r\n    ### SAMPLE\r\n    $ vagrant box add centos65 centos65-x86_64-20140707.box\r\n    $ mkdir test_env\r\n    $ cd test_env/\r\n    $ vagrant init centos65\r\n    $ vagrant up\r\n    $ vagrant ssh\r\n\r\n### <span style=\"color:red\">Error solving (sudo: sorry, you must have a tty to run sudo)</span>\r\n    # Edit vagrantfile from actVM\r\n    add Line \r\n\t    => config.ssh.pty = true \r\n\r\n### Vagrantfile (with GUI and more memory)\r\n\tconfig.vm.provider \"virtualbox\" do |vb|\r\n\t\tvb.gui = true\r\n\t\tvb.customize [\"modifyvm\", :id, \"--memory\", \"4096\"]\r\n  \tend\r\n\r\nLicense\r\n--------------\r\n\r\nMIT\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}